#!/bin/sh
set -e

echo "Downloading twistcli..."
curl --progress-bar -L -k --header "authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyIjoic3JhdXRAcGFsb2FsdG9uZXR3b3Jrcy5jb20iLCJyb2xlIjoiYWRtaW4iLCJyb2xlUGVybXMiOltbMjU1LDI1NSwyNTUsMjU1LDI1NSw5NV0sWzI1NSwyNTUsMjU1LDI1NSwyNTUsOTVdXSwic2Vzc2lvblRpbWVvdXRTZWMiOjUwNywic2Fhc1Rva2VuIjoiZXlKaGJHY2lPaUpJVXpJMU5pSjkuZXlKemRXSWlPaUp6Y21GMWRFQndZV3h2WVd4MGIyNWxkSGR2Y210ekxtTnZiU0lzSW5ObGNuWnBZMlZWYzJGblpVOXViSGtpT25SeWRXVXNJbVpwY25OMFRHOW5hVzRpT21aaGJITmxMQ0p3Y21semJXRkpaQ0k2SWpneE56UXlOVEkxTmpJMU1UQXdPREF3TUNJc0ltbHdRV1JrY21WemN5STZJak0wTGpFek9TNDJOQzR4TlRBaUxDSnBjM01pT2lKb2RIUndjem92TDJGd2FUSXVjSEpwYzIxaFkyeHZkV1F1YVc4aUxDSnlaWE4wY21samRDSTZNQ3dpZFhObGNsSnZiR1ZVZVhCbFJHVjBZV2xzY3lJNmV5Sm9ZWE5QYm14NVVtVmhaRUZqWTJWemN5STZabUZzYzJWOUxDSjFjMlZ5VW05c1pWUjVjR1ZPWVcxbElqb2lVM2x6ZEdWdElFRmtiV2x1SWl3aWFYTlRVMDlUWlhOemFXOXVJanBtWVd4elpTd2liR0Z6ZEV4dloybHVWR2x0WlNJNk1UYzBNems0TmprNE16QXlOaXdpWVhWa0lqb2lhSFIwY0hNNkx5OWhjR2t5TG5CeWFYTnRZV05zYjNWa0xtbHZJaXdpZFhObGNsSnZiR1ZVZVhCbFNXUWlPakVzSW1GMWRHZ3RiV1YwYUc5a0lqb2lVRUZUVTFkUFVrUWlMQ0p6Wld4bFkzUmxaRU4xYzNSdmJXVnlUbUZ0WlNJNklsQmhiRzhnUVd4MGJ5Qk9aWFIzYjNKcmN5QW9WRVZUVkNCQlEwTlVLU0F0SURZeE56RXhOek0wTVRjek5qY3lNRGsxT0RRaUxDSnpaWE56YVc5dVZHbHRaVzkxZENJNk16QXdMQ0oxYzJWeVVtOXNaVWxrSWpvaU1XSTFORE5oTmpFdE5XRXhPUzAwT1RJMExUa3pNalV0T1dFeFl6WTNaakprWW1NMklpd2lhR0Z6UkdWbVpXNWtaWEpRWlhKdGFYTnphVzl1Y3lJNmRISjFaU3dpWlhod0lqb3hOelF6T1RnM05UZzJMQ0pwWVhRaU9qRTNORE01T0RZNU9EWXNJblZ6WlhKdVlXMWxJam9pYzNKaGRYUkFjR0ZzYjJGc2RHOXVaWFIzYjNKcmN5NWpiMjBpTENKMWMyVnlVbTlzWlU1aGJXVWlPaUpUZVhOMFpXMGdRV1J0YVc0aWZRLmtlVHF3MUlQMVZEUkU0ZlMyUS1UbV9mX3pVWUt5d1lZN18wV3ZnOVhJQWMiLCJpc3MiOiJ0d2lzdGxvY2siLCJleHAiOjE3NDM5OTA2Nzl9.sPOAJkSJGlrCaFnWmGgbnRfhOfjb5O2o19aq_thyp4E" https://us-east1.cloud.twistlock.com/us-2-158290582/api/v1/util/twistcli > /tmp/twistcli; chmod a+x /tmp/twistcli;

echo "Running twistcli hosts scan..."
/tmp/twistcli --debug hosts scan \
  --address "$PRISMA_CONSOLE" \
  --user "$PRISMA_USER" \
  --password '$PRISMA_PASS' \
  --skip-docker \
  --details
  --include-3rd-party

